#!/usr/bin/env python3
"""
ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚µãƒ³ãƒ—ãƒ«ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
URLæ©Ÿèƒ½ä»˜ããƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®ãƒ†ã‚¹ãƒˆç”¨
"""

import re
import hashlib
import urllib.parse
from datetime import datetime, timedelta

def generate_note_url(note_content):
    """ãƒãƒ¼ãƒˆå†…å®¹ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ç”¨URLã‚’ç”Ÿæˆã™ã‚‹"""
    try:
        note_hash = hashlib.md5(note_content.encode('utf-8')).hexdigest()[:16]

        title_match = re.search(r'\[ãƒãƒ¼ãƒˆ\]([^\n]+)', note_content)
        if title_match:
            title = title_match.group(1).strip()[:50]
        else:
            title = note_content[:50].replace('\n', ' ').strip()

        encoded_title = urllib.parse.quote(title)
        note_url = f"http://localhost:5000/note/{note_hash}?title={encoded_title}"

        return note_url, note_hash

    except Exception as e:
        return "", ""

def create_sample_reminder_message():
    """ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆ"""

    # ã‚µãƒ³ãƒ—ãƒ«ãƒãƒ¼ãƒˆ
    sample_note = """[ãƒãƒ¼ãƒˆ] ğŸ¥ ã‚½ãƒ•ãƒˆãƒœãƒ¼ãƒ«ç§‹å­£å¤§ä¼š
ğŸ“… é–‹å‚¬æ—¥: 2025/10/30(æ°´) 9:00-17:00
ğŸ“ å ´æ‰€: ç”°åœ’èª¿å¸ƒå°å­¦æ ¡ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰

å…¥åŠ›æœŸé™: 2025/10/29(ç«) 18:00

ã€å‚åŠ ç¢ºèªäº‹é …ã€‘
âœ… é¸æ‰‹å‚åŠ å¯å¦
âœ… ä¿è­·è€…å¿œæ´å‚åŠ 
âœ… è»Šå‡ºã—å”åŠ›
âœ… ç”¨å…·æº–å‚™å½“ç•ª

ã€æŒã¡ç‰©ã€‘
- ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒ 
- ã‚°ãƒ­ãƒ¼ãƒ–ãƒ»ãƒãƒƒãƒˆ
- é£²ã¿ç‰©
- ã‚¿ã‚ªãƒ«
- å¿œæ´ã‚°ãƒƒã‚º

ã€æ³¨æ„äº‹é …ã€‘
é›¨å¤©æ™‚ã¯ç¿Œæ—¥ã«é †å»¶ã¨ãªã‚Šã¾ã™ã€‚
å½“æ—¥æœ6:00ã«æœ€çµ‚åˆ¤æ–­ã‚’ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ã€‚

ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ï¼"""

    # URLç”Ÿæˆ
    note_url, note_hash = generate_note_url(sample_note)

    # æ—¥ä»˜æƒ…å ±
    event_date = datetime(2025, 10, 30).date()
    today = datetime.now().date()
    tomorrow = today + timedelta(days=1)

    # æ˜æ—¥ãŒå…¥åŠ›æœŸé™ã®å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    formatted_date = event_date.strftime("%Yå¹´%mæœˆ%dæ—¥")
    weekdays = ["æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ", "æ—¥"]
    weekday = weekdays[event_date.weekday()]
    date_with_weekday = f"{formatted_date}({weekday})"

    # ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸çµ„ã¿ç«‹ã¦
    message = f"""â° ã€ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ï¼ˆå‰æ—¥é€šçŸ¥ï¼‰ã€‘

{date_with_weekday}ã®ã‚¤ãƒ™ãƒ³ãƒˆã®å…¥åŠ›æœŸé™ã§ã™ã€‚
ã”ç¢ºèªãã ã•ã„ã€‚


ğŸ“‹ **ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°**
{sample_note}

==================================================

ğŸŒ¤ï¸ **å¤©æ°—æƒ…å ±**: å½“æ—¥ã®å¤©æ°—äºˆå ±ã‚’ã”ç¢ºèªãã ã•ã„

==================================================

ğŸ”— **ãƒãƒ¼ãƒˆè©³ç´°URL**
{note_url}
ğŸ‘† ä¸Šè¨˜URLã§ãƒãƒ¼ãƒˆã®è©³ç´°æƒ…å ±ã‚’ç¢ºèªã§ãã¾ã™"""

    return message, note_hash

def main():
    """ãƒ¡ã‚¤ãƒ³å‡¦ç†"""
    print("=" * 70)
    print("ğŸ”— ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼URLæ©Ÿèƒ½ - ã‚µãƒ³ãƒ—ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸")
    print("=" * 70)

    # ã‚µãƒ³ãƒ—ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ
    message, note_hash = create_sample_reminder_message()

    print("ğŸ“¨ ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚µãƒ³ãƒ—ãƒ«:")
    print("-" * 50)
    print(message)
    print("-" * 50)

    print(f"\nâœ¨ æ–°æ©Ÿèƒ½ã®ç‰¹å¾´:")
    print(f"ğŸ”— ãƒãƒ¼ãƒˆURL: ãƒ¦ãƒ‹ãƒ¼ã‚¯ãƒãƒƒã‚·ãƒ¥ID ({note_hash}) ã§ãƒãƒ¼ãƒˆè©³ç´°ã«ã‚¢ã‚¯ã‚»ã‚¹")
    print(f"ğŸŒ Webã‚¢ã‚¯ã‚»ã‚¹: http://localhost:5000/note/{note_hash}")
    print(f"ğŸ“± ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ: ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã§æºå¸¯ã‹ã‚‰ã‚‚é–²è¦§å¯èƒ½")
    print(f"ğŸ¯ æƒ…å ±çµ±åˆ: å¤©æ°—æƒ…å ± + ãƒãƒ¼ãƒˆè©³ç´° + URLã‚’ä¸€ã¤ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«")

    print(f"\nâš™ï¸ å®Ÿè£…ã•ã‚ŒãŸæ©Ÿèƒ½:")
    print(f"âœ… ãƒãƒ¼ãƒˆå†…å®¹ã‹ã‚‰URLè‡ªå‹•ç”Ÿæˆ")
    print(f"âœ… ã‚¿ã‚¤ãƒˆãƒ«æŠ½å‡ºã¨URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°")
    print(f"âœ… ãƒãƒƒã‚·ãƒ¥ãƒ™ãƒ¼ã‚¹ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ID")
    print(f"âœ… HTMLãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆè¦‹ã‚„ã™ã„è¡¨ç¤ºï¼‰")
    print(f"âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°")

    print(f"\nğŸš€ ä½¿ç”¨æ–¹æ³•:")
    print(f"1. ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡")
    print(f"2. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…ã®URLã‚’ã‚¯ãƒªãƒƒã‚¯")
    print(f"3. ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒãƒ¼ãƒˆè©³ç´°ã‚’ç¢ºèª")
    print(f"4. å¿…è¦ã«å¿œã˜ã¦æƒ…å ±ã‚’å‚ç…§ãƒ»å…±æœ‰")

if __name__ == "__main__":
    main()

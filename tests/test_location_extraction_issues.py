#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
å ´æ‰€æƒ…å ±æŠ½å‡ºã®å•é¡Œã‚’ç‰¹å®šã™ã‚‹ãƒ†ã‚¹ãƒˆ
"""

import sys
import os
sys.path.append(os.path.join(os.path.dirname(__file__), '..', 'src'))

from reminder_flex_customizer import ReminderFlexCustomizer

def test_location_extraction_issues():
    """å ´æ‰€æƒ…å ±æŠ½å‡ºã®å•é¡Œç¢ºèªãƒ†ã‚¹ãƒˆ"""
    print("=" * 80)
    print("ğŸ—ºï¸ å ´æ‰€æƒ…å ±æŠ½å‡ºã®å•é¡Œç¢ºèªãƒ†ã‚¹ãƒˆ")
    print("=" * 80)

    customizer = ReminderFlexCustomizer()

    # å•é¡ŒãŒç™ºç”Ÿã—ãã†ãªãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
    test_cases = [
        {
            "name": "æ­£å¸¸ãªã‚±ãƒ¼ã‚¹ï¼ˆè‘›é£¾åŒºæŸ´åˆçƒå ´ï¼‰",
            "content": """è‘›é£¾åŒºæŸ´åˆå°‘å¹´é‡çƒå¤§ä¼š
å ´æ‰€ï¼šè‘›é£¾åŒºæŸ´åˆçƒå ´ç¬¬ä¸€ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰
é›†åˆæ™‚é–“ï¼š17:45ï¼ˆè©¦åˆé–‹å§‹18:00ï¼‰
æŒã¡ç‰©ï¼šã‚°ãƒ­ãƒ¼ãƒ–ã€ãƒãƒƒãƒˆã€é£²ã¿ç‰©
é€£çµ¡å…ˆï¼šæŸ´åˆå¤ªéƒ""",
            "expected": "è‘›é£¾åŒºæŸ´åˆçƒå ´ç¬¬ä¸€ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰"
        },
        {
            "name": "æ­£å¸¸ãªã‚±ãƒ¼ã‚¹ï¼ˆæ¨ªæµœå¸‚é’è‘‰åŒºï¼‰",
            "content": """æ¨ªæµœå¸‚é’è‘‰åŒºæ˜¥å­£å¤§ä¼š
ä¼šå ´ï¼šæ¨ªæµœå¸‚é’è‘‰åŒºç·åˆé‹å‹•å ´é‡çƒå ´
æ™‚é–“ï¼šåˆå¾Œ2æ™‚é–‹å§‹
æŒå‚ï¼šãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒ ã€ã‚¹ãƒ‘ã‚¤ã‚¯
æ‹…å½“ï¼šé’è‘‰èŠ±å­""",
            "expected": "æ¨ªæµœå¸‚é’è‘‰åŒºç·åˆé‹å‹•å ´é‡çƒå ´"
        },
        {
            "name": "é•·ã„ãƒ†ã‚­ã‚¹ãƒˆãŒå«ã¾ã‚Œã‚‹ã‚±ãƒ¼ã‚¹",
            "content": """æ˜¥å­£é‡çƒå¤§ä¼šã®ãŠçŸ¥ã‚‰ã›
å ´æ‰€ï¼šè‘›é£¾åŒºæŸ´åˆçƒå ´ç¬¬ä¸€ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼ˆé§è»Šå ´ã¯é™ã‚ŠãŒã‚ã‚Šã¾ã™ã®ã§ã€å…¬å…±äº¤é€šæ©Ÿé–¢ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚æœ€å¯„ã‚Šé§…ã¯äº¬æˆé‡‘ç”ºç·šæŸ´åˆé§…ã‹ã‚‰å¾’æ­©15åˆ†ã§ã™ï¼‰
æ™‚é–“ï¼šåˆå‰10æ™‚é–‹å§‹
æŒã¡ç‰©ï¼šãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒ ä¸€å¼
é€£çµ¡å…ˆï¼šå¤§ä¼šäº‹å‹™å±€""",
            "expected_contains": "è‘›é£¾åŒºæŸ´åˆçƒå ´ç¬¬ä¸€ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰"
        },
        {
            "name": "è¤‡æ•°ã®å ´æ‰€æƒ…å ±ãŒã‚ã‚‹ã‚±ãƒ¼ã‚¹",
            "content": """ç§‹å­£å¤§ä¼š
é›†åˆå ´æ‰€ï¼šè‘›é£¾åŒºæŸ´åˆé§…å‰åºƒå ´
ä¼šå ´ï¼šè‘›é£¾åŒºæŸ´åˆçƒå ´ç¬¬ä¸€ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰
æ™‚é–“ï¼šåˆå¾Œ1æ™‚é›†åˆã€åˆå¾Œ2æ™‚é–‹å§‹
é€£çµ¡å…ˆï¼šç”°ä¸­""",
            "expected": "è‘›é£¾åŒºæŸ´åˆé§…å‰åºƒå ´"  # æœ€åˆã«è¦‹ã¤ã‹ã£ãŸå ´æ‰€
        },
        {
            "name": "æ–½è¨­åã ã‘ã®ã‚±ãƒ¼ã‚¹",
            "content": """ç·´ç¿’è©¦åˆ
æ±äº¬ãƒ‰ãƒ¼ãƒ ã«ã¦é–‹å‚¬
æ™‚é–“ï¼šåˆå¾Œ7æ™‚é–‹å§‹
å‚åŠ è²»ï¼š3000å††""",
            "expected": "æ±äº¬ãƒ‰ãƒ¼ãƒ "
        },
        {
            "name": "ä¸è¦ãªæƒ…å ±ãŒå«ã¾ã‚Œã‚‹ã‚±ãƒ¼ã‚¹",
            "content": """å¤å­£åˆå®¿
å ´æ‰€ï¼šè»½äº•æ²¢ç·åˆé‹å‹•å ´é‡çƒå ´ã€å®¿æ³Šã¯è¿‘éš£ãƒ›ãƒ†ãƒ«ã€é£Ÿäº‹ã¯çƒå ´å†…ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³åˆ©ç”¨å¯
æœŸé–“ï¼š8æœˆ10-12æ—¥
è²»ç”¨ï¼š25000å††""",
            "expected_contains": "è»½äº•æ²¢ç·åˆé‹å‹•å ´é‡çƒå ´"
        }
    ]

    for i, test_case in enumerate(test_cases, 1):
        print(f"\nğŸ§ª ãƒ†ã‚¹ãƒˆ {i}: {test_case['name']}")
        print("-" * 60)

        # å ´æ‰€æƒ…å ±æŠ½å‡º
        extracted_location = customizer._extract_location_info(test_case["content"])

        print(f"ğŸ“ å…¥åŠ›å†…å®¹:")
        for line in test_case["content"].split('\n')[:3]:  # æœ€åˆã®3è¡Œã®ã¿è¡¨ç¤º
            print(f"    {line}")
        if len(test_case["content"].split('\n')) > 3:
            print("    ...")

        print(f"ğŸ¯ æœŸå¾…å€¤: {test_case.get('expected', 'ç‰¹å®šã®æ–‡å­—åˆ—ã‚’å«ã‚€')}")
        if 'expected_contains' in test_case:
            print(f"   å«ã‚€ã¹ãæ–‡å­—åˆ—: {test_case['expected_contains']}")

        print(f"ğŸ“¤ æŠ½å‡ºçµæœ: {extracted_location}")

        # åˆ¤å®š
        if 'expected' in test_case:
            if extracted_location == test_case['expected']:
                print("âœ… å®Œå…¨ä¸€è‡´")
            else:
                print("âŒ ä¸ä¸€è‡´")
        elif 'expected_contains' in test_case:
            if extracted_location and test_case['expected_contains'] in extracted_location:
                print("âœ… å«ã¾ã‚Œã¦ã„ã‚‹")
                if len(extracted_location) > len(test_case['expected_contains']) + 10:
                    print("âš ï¸ ãŸã ã—ã€ä½™åˆ†ãªæƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã¾ã™")
            else:
                print("âŒ å«ã¾ã‚Œã¦ã„ãªã„")

    print("\n" + "=" * 80)
    print("ğŸ‰ å ´æ‰€æƒ…å ±æŠ½å‡ºå•é¡Œç¢ºèªãƒ†ã‚¹ãƒˆå®Œäº†")
    print("=" * 80)

if __name__ == "__main__":
    test_location_extraction_issues()
